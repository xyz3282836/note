<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://www.ruizhou.cf/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html"><meta property="og:site_name" content="文档演示"><meta property="og:title" content="版本升级"><meta property="og:description" content="1.16 go.1.12 - go1.15版本的内存回收策略使用的是MADVFREE，1.16后使用的是MADVDONTNEED策略。 Runtime The new runtime/metrics (https://go.dev/pkg/runtime/metrics/) package introduces a stable interface f..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-02-27T15:01:36.000Z"><meta property="article:modified_time" content="2023-02-27T15:01:36.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"版本升级","image":[""],"dateModified":"2023-02-27T15:01:36.000Z","author":[]}</script><title>版本升级 | 文档演示</title><meta name="description" content="1.16 go.1.12 - go1.15版本的内存回收策略使用的是MADVFREE，1.16后使用的是MADVDONTNEED策略。 Runtime The new runtime/metrics (https://go.dev/pkg/runtime/metrics/) package introduces a stable interface f...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-b14ff2dd.css" as="style"><link rel="stylesheet" href="/assets/style-b14ff2dd.css">
    <link rel="modulepreload" href="/assets/app-cd392658.js"><link rel="modulepreload" href="/assets/framework-7d796c00.js"><link rel="modulepreload" href="/assets/版本升级.html-3a670f19.js"><link rel="modulepreload" href="/assets/版本升级.html-355f5627.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/hero.png" alt="文档演示"><!----><span class="site-name hide-in-pad">文档演示</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="rz的文档"><span class="font-icon icon iconfont icon-home" style=""></span>rz的文档<!----></a></div><div class="nav-item hide-in-mobile"><a href="/raw/" class="nav-link active" aria-label="文档"><span class="font-icon icon iconfont icon-note" style=""></span>文档<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="GO"><span class="title"><span class="font-icon icon iconfont icon-creative" style=""></span>GO</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Go汇编</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/raw/Go/Go%E6%B1%87%E7%BC%96/dlv%E5%91%BD%E4%BB%A4.html" class="nav-link" aria-label="dlv命令"><!---->dlv命令<!----></a></li><li class="dropdown-subitem"><a href="/raw/Go/Go%E6%B1%87%E7%BC%96/plan9.html" class="nav-link" aria-label="plan9"><!---->plan9<!----></a></li></ul></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/xyz3282836/monodoc" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">工具</span><span class="arrow end"></span></button><!----></section></li><li><!--[--><a href="/raw/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html" class="nav-link sidebar-link sidebar-page" aria-label="进程与线程"><!---->进程与线程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">领域设计</span><span class="arrow end"></span></button><!----></section></li><li><!--[--><a href="/raw/go%20doc%20%E6%AF%9B%E8%80%81%E5%B8%88.html" class="nav-link sidebar-link sidebar-page" aria-label="毛老师推荐go文章"><!---->毛老师推荐go文章<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/%E9%9D%A2%E8%AF%95.html" class="nav-link sidebar-link sidebar-page" aria-label="面试"><!---->面试<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/%E5%86%85%E5%AD%98%E8%80%97%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="内存耗用"><!---->内存耗用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/%E7%A8%8B%E5%BA%8F-%E6%95%B0%E5%AD%A6.html" class="nav-link sidebar-link sidebar-page" aria-label="奇偶校验"><!---->奇偶校验<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">人工智能</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">数据结构</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">数据库</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">算法</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">协议</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">源码</span><span class="arrow end"></span></button><!----></section></li><li><!--[--><a href="/raw/%E6%9D%82%E8%AE%B0.html" class="nav-link sidebar-link sidebar-page" aria-label="杂记"><!---->杂记<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/%E6%AD%A3%E5%88%99.html" class="nav-link sidebar-link sidebar-page" aria-label="正则"><!---->正则<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Apue</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">B站基架</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Docker</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Es</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">Go</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="版本升级"><!---->版本升级<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-16" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.16"><!---->1.16<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#runtime" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Runtime"><!---->Runtime<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-17" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.17"><!---->1.17<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#compiler" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Compiler"><!---->Compiler<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-18" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.18"><!---->1.18<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#runtime-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Runtime"><!---->Runtime<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#compiler-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Compiler"><!---->Compiler<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-19" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.19"><!---->1.19<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#runtime-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Runtime"><!---->Runtime<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#compiler-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Compiler"><!---->Compiler<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#线上升级案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="线上升级案例"><!---->线上升级案例<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-17升级" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.17升级"><!---->1.17升级<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-19升级" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.19升级"><!---->1.19升级<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#reference" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="reference"><!---->reference<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/raw/Go/%E6%A6%82%E5%BF%B5.html" class="nav-link sidebar-link sidebar-page" aria-label="基础概念"><!---->基础概念<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/%E6%AF%9B%E5%89%91.html" class="nav-link sidebar-link sidebar-page" aria-label="毛老师语录"><!---->毛老师语录<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/%E6%9D%82%E9%A1%B9.html" class="nav-link sidebar-link sidebar-page" aria-label="杂项"><!---->杂项<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/dlv%E5%91%BD%E4%BB%A4.html" class="nav-link sidebar-link sidebar-page" aria-label="dlv命令"><!---->dlv命令<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/gc.html" class="nav-link sidebar-link sidebar-page" aria-label="gc"><!---->gc<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/go%20%E5%9F%BA%E7%A1%80.html" class="nav-link sidebar-link sidebar-page" aria-label="go 基础"><!---->go 基础<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/go%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4.html" class="nav-link sidebar-link sidebar-page" aria-label="go 命令"><!---->go 命令<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/gogc%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" class="nav-link sidebar-link sidebar-page" aria-label="go gc性能优化"><!---->go gc性能优化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/mod.html" class="nav-link sidebar-link sidebar-page" aria-label="Go Mod"><!---->Go Mod<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Go Profiles</span><span class="arrow end"></span></button><!----></section></li><li><!--[--><a href="/raw/Go/go%20test.html" class="nav-link sidebar-link sidebar-page" aria-label="go test"><!---->go test<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/go%20tool%20compile.html" class="nav-link sidebar-link sidebar-page" aria-label="go tool compile"><!---->go tool compile<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/Go%20%E9%97%AD%E5%8C%85.html" class="nav-link sidebar-link sidebar-page" aria-label="go闭包"><!---->go闭包<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/go%20%E8%B0%83%E5%BA%A6.html" class="nav-link sidebar-link sidebar-page" aria-label="go的调度"><!---->go的调度<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Go汇编</span><span class="arrow end"></span></button><!----></section></li><li><!--[--><a href="/raw/Go/gpm.html" class="nav-link sidebar-link sidebar-page" aria-label="gpm"><!---->gpm<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/kafka.html" class="nav-link sidebar-link sidebar-page" aria-label="kafka"><!---->kafka<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/proto%20%E5%BA%8F%E5%88%97%E5%8C%96.html" class="nav-link sidebar-link sidebar-page" aria-label="proto"><!---->proto<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/protoc.html" class="nav-link sidebar-link sidebar-page" aria-label="protoc"><!---->protoc<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/Go/test.html" class="nav-link sidebar-link sidebar-page" aria-label="test md img"><!---->test md img<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Kv</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Linux</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Malloc</span><span class="arrow end"></span></button><!----></section></li><li><!--[--><a href="/raw/feature.html" class="nav-link sidebar-link sidebar-page" aria-label="New Tech"><!---->New Tech<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/raw/testpic.html" class="nav-link sidebar-link sidebar-page" aria-label="TestPic"><!---->TestPic<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Ubuntu</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Xdp</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->版本升级</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/xyz3282836/monodoc" target="_blank" rel="noopener noreferrer">rz</a></span><span property="author" content="rz"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-27T15:01:36.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 7 分钟</span><meta property="timeRequired" content="PT7M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-16" class="router-link-active router-link-exact-active toc-link level2">1.16</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#runtime" class="router-link-active router-link-exact-active toc-link level3">Runtime</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-17" class="router-link-active router-link-exact-active toc-link level2">1.17</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#compiler" class="router-link-active router-link-exact-active toc-link level3">Compiler</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-18" class="router-link-active router-link-exact-active toc-link level2">1.18</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#runtime-1" class="router-link-active router-link-exact-active toc-link level3">Runtime</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#compiler-1" class="router-link-active router-link-exact-active toc-link level3">Compiler</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-19" class="router-link-active router-link-exact-active toc-link level2">1.19</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#runtime-2" class="router-link-active router-link-exact-active toc-link level3">Runtime</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#compiler-2" class="router-link-active router-link-exact-active toc-link level3">Compiler</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#线上升级案例" class="router-link-active router-link-exact-active toc-link level2">线上升级案例</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-17升级" class="router-link-active router-link-exact-active toc-link level3">1.17升级</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#_1-19升级" class="router-link-active router-link-exact-active toc-link level3">1.19升级</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/raw/Go/%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7.html#reference" class="router-link-active router-link-exact-active toc-link level2">reference</a></li><!----><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="版本升级" tabindex="-1"><a class="header-anchor" href="#版本升级" aria-hidden="true">#</a> 版本升级</h1><h2 id="_1-16" tabindex="-1"><a class="header-anchor" href="#_1-16" aria-hidden="true">#</a> 1.16</h2><p>go.1.12 - go1.15版本的内存回收策略使用的是MADV_FREE，1.16后使用的是MADV_DONTNEED策略。</p><h3 id="runtime" tabindex="-1"><a class="header-anchor" href="#runtime" aria-hidden="true">#</a> Runtime</h3><p>The new <a href="https://go.dev/pkg/runtime/metrics/" target="_blank" rel="noopener noreferrer"><code>runtime/metrics</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> package introduces a stable interface for reading implementation-defined metrics from the Go runtime. It supersedes existing functions like <a href="https://go.dev/pkg/runtime/#ReadMemStats" target="_blank" rel="noopener noreferrer"><code>runtime.ReadMemStats</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://go.dev/pkg/runtime/debug/#GCStats" target="_blank" rel="noopener noreferrer"><code>debug.GCStats</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and is significantly more general and efficient. See the package documentation for more details.</p><p>Setting the <code>GODEBUG</code> environment variable to <code>inittrace=1</code> now causes the runtime to emit a single line to standard error for each package <code>init</code>, summarizing its execution time and memory allocation. This trace can be used to find bottlenecks or regressions in Go startup performance. The <a href="https://go.dev/pkg/runtime/#hdr-Environment_Variables" target="_blank" rel="noopener noreferrer"><code>GODEBUG</code> documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> describes the format.</p><p>On Linux, the runtime now defaults to releasing memory to the operating system promptly (using <code>MADV_DONTNEED</code>), rather than lazily when the operating system is under memory pressure (using <code>MADV_FREE</code>). This means process-level memory statistics like RSS will more accurately reflect the amount of physical memory being used by Go processes. Systems that are currently using <code>GODEBUG=madvdontneed=1</code> to improve memory monitoring behavior no longer need to set this environment variable.</p><p>Go 1.16 fixes a discrepancy between the race detector and the <a href="https://go.dev/ref/mem" target="_blank" rel="noopener noreferrer">Go memory model<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. The race detector now more precisely follows the channel synchronization rules of the memory model. As a result, the detector may now report races it previously missed.</p><h2 id="_1-17" tabindex="-1"><a class="header-anchor" href="#_1-17" aria-hidden="true">#</a> 1.17</h2><h3 id="compiler" tabindex="-1"><a class="header-anchor" href="#compiler" aria-hidden="true">#</a> Compiler</h3><p>Go 1.17 implements a new way of passing function arguments and results using registers instead of the stack. Benchmarks for a representative set of Go packages and programs show performance improvements of about 5%, and a typical reduction in binary size of about 2%. This is currently enabled for Linux, macOS, and Windows on the 64-bit x86 architecture (the <code>linux/amd64</code>, <code>darwin/amd64</code>, and <code>windows/amd64</code> ports).</p><p>调用惯例(calling convention)带来了函数调用的优化，官方说明是**5%**的性能提升。</p><h2 id="_1-18" tabindex="-1"><a class="header-anchor" href="#_1-18" aria-hidden="true">#</a> 1.18</h2><h3 id="runtime-1" tabindex="-1"><a class="header-anchor" href="#runtime-1" aria-hidden="true">#</a> Runtime</h3><p>The garbage collector now includes non-heap sources of garbage collector work (e.g., stack scanning) when determining how frequently to run. As a result, garbage collector overhead is more predictable when these sources are significant. For most applications these changes will be negligible; however, some Go applications may now use less memory and spend more time on garbage collection, or vice versa, than before. The intended workaround is to tweak <code>GOGC</code> where necessary.</p><p>The runtime now returns memory to the operating system more efficiently and has been tuned to work more aggressively as a result.</p><p>Go 1.17 generally improved the formatting of arguments in stack traces, but could print inaccurate values for arguments passed in registers. This is improved in Go 1.18 by printing a question mark (<code>?</code>) after each value that may be inaccurate.</p><p>The built-in function <code>append</code> now uses a slightly different formula when deciding how much to grow a slice when it must allocate a new underlying array. The new formula is less prone to sudden transitions in allocation behavior.</p><p>小优化</p><h3 id="compiler-1" tabindex="-1"><a class="header-anchor" href="#compiler-1" aria-hidden="true">#</a> Compiler</h3><p>Go 1.17 <a href="https://go.dev/doc/go1.17#compiler" target="_blank" rel="noopener noreferrer">implemented<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> a new way of passing function arguments and results using registers instead of the stack on 64-bit x86 architecture on selected operating systems. Go 1.18 expands the supported platforms to include 64-bit ARM (<code>GOARCH=arm64</code>), big- and little-endian 64-bit PowerPC (<code>GOARCH=ppc64</code>, <code>ppc64le</code>), as well as 64-bit x86 architecture (<code>GOARCH=amd64</code>) on all operating systems. On 64-bit ARM and 64-bit PowerPC systems, benchmarking shows typical performance improvements of 10% or more.</p><p>As <a href="https://go.dev/doc/go1.17#compiler" target="_blank" rel="noopener noreferrer">mentioned<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> in the Go 1.17 release notes, this change does not affect the functionality of any safe Go code and is designed to have no impact on most assembly code. See the <a href="https://go.dev/doc/go1.17#compiler" target="_blank" rel="noopener noreferrer">Go 1.17 release notes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details.</p><p>The compiler now can inline functions that contain range loops or labeled for loops.</p><p>The new <code>-asan</code> compiler option supports the new <code>go</code> command <code>-asan</code> option.</p><p>Because the compiler&#39;s type checker was replaced in its entirety to support generics, some error messages now may use different wording than before. In some cases, pre-Go 1.18 error messages provided more detail or were phrased in a more helpful way. We intend to address these cases in Go 1.19.</p><p>Because of changes in the compiler related to supporting generics, the Go 1.18 compile speed can be roughly 15% slower than the Go 1.17 compile speed. The execution time of the compiled code is not affected. We intend to improve the speed of the compiler in future releases.</p><p>1.18由于引入generics泛型，编译速度慢了15%，执行不受影响。</p><h2 id="_1-19" tabindex="-1"><a class="header-anchor" href="#_1-19" aria-hidden="true">#</a> 1.19</h2><h3 id="runtime-2" tabindex="-1"><a class="header-anchor" href="#runtime-2" aria-hidden="true">#</a> Runtime</h3><p>The runtime now includes support for a soft memory limit. This memory limit includes the Go heap and all other memory managed by the runtime, and excludes external memory sources such as mappings of the binary itself, memory managed in other languages, and memory held by the operating system on behalf of the Go program. This limit may be managed via <a href="https://go.dev/pkg/runtime/debug/#SetMemoryLimit" target="_blank" rel="noopener noreferrer"><code>runtime/debug.SetMemoryLimit</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> or the equivalent <a href="https://go.dev/pkg/runtime/#hdr-Environment_Variables" target="_blank" rel="noopener noreferrer"><code>GOMEMLIMIT</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> environment variable. The limit works in conjunction with <a href="https://go.dev/pkg/runtime/debug/#SetGCPercent" target="_blank" rel="noopener noreferrer"><code>runtime/debug.SetGCPercent</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> / <a href="https://go.dev/pkg/runtime/#hdr-Environment_Variables" target="_blank" rel="noopener noreferrer"><code>GOGC</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, and will be respected even if <code>GOGC=off</code>, allowing Go programs to always make maximal use of their memory limit, improving resource efficiency in some cases. See <a href="https://go.dev/doc/gc-guide" target="_blank" rel="noopener noreferrer">the GC guide<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for a detailed guide explaining the soft memory limit in more detail, as well as a variety of common use-cases and scenarios. Please note that small memory limits, on the order of tens of megabytes or less, are less likely to be respected due to external latency factors, such as OS scheduling. See <a href="https://go.dev/issue/52433" target="_blank" rel="noopener noreferrer">issue 52433<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more details. Larger memory limits, on the order of hundreds of megabytes or more, are stable and production-ready.</p><p>In order to limit the effects of GC thrashing when the program&#39;s live heap size approaches the soft memory limit, the Go runtime also attempts to limit total GC CPU utilization to 50%, excluding idle time, choosing to use more memory over preventing application progress. In practice, we expect this limit to only play a role in exceptional cases, and the new <a href="https://go.dev/pkg/runtime/metrics/#hdr-Supported_metrics" target="_blank" rel="noopener noreferrer">runtime metric<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <code>/gc/limiter/last-enabled:gc-cycle</code> reports when this last occurred.</p><p>The runtime now schedules many fewer GC worker goroutines on idle operating system threads when the application is idle enough to force a periodic GC cycle.</p><p>The runtime will now allocate initial goroutine stacks based on the historic average stack usage of goroutines. This avoids some of the early stack growth and copying needed in the average case in exchange for at most 2x wasted space on below-average goroutines.</p><p>On Unix operating systems, Go programs that import package <a href="https://go.dev/pkg/os/" target="_blank" rel="noopener noreferrer">os<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> now automatically increase the open file limit (<code>RLIMIT_NOFILE</code>) to the maximum allowed value; that is, they change the soft limit to match the hard limit. This corrects artificially low limits set on some systems for compatibility with very old C programs using the <a href="https://en.wikipedia.org/wiki/Select_(Unix)" target="_blank" rel="noopener noreferrer"><em>select</em><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> system call. Go programs are not helped by that limit, and instead even simple programs like <code>gofmt</code> often ran out of file descriptors on such systems when processing many files in parallel. One impact of this change is that Go programs that in turn execute very old C programs in child processes may run those programs with too high a limit. This can be corrected by setting the hard limit before invoking the Go program.</p><p>Unrecoverable fatal errors (such as concurrent map writes, or unlock of unlocked mutexes) now print a simpler traceback excluding runtime metadata (equivalent to a fatal panic) unless <code>GOTRACEBACK=system</code> or <code>crash</code>. Runtime-internal fatal error tracebacks always include full metadata regardless of the value of <code>GOTRACEBACK</code></p><p>Support for debugger-injected function calls has been added on ARM64, enabling users to call functions from their binary in an interactive debugging session when using a debugger that is updated to make use of this functionality.</p><p>The <a href="https://go.dev/doc/go1.18#go-build-asan" target="_blank" rel="noopener noreferrer">address sanitizer support added in Go 1.18<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> now handles function arguments and global variables more precisely.</p><h3 id="compiler-2" tabindex="-1"><a class="header-anchor" href="#compiler-2" aria-hidden="true">#</a> Compiler</h3><p>The compiler now uses a <a href="https://en.wikipedia.org/wiki/Branch_table" target="_blank" rel="noopener noreferrer">jump table<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to implement large integer and string switch statements. Performance improvements for the switch statement vary but can be on the order of 20% faster. (<code>GOARCH=amd64</code> and <code>GOARCH=arm64</code> only)</p><p>The Go compiler now requires the <code>-p=importpath</code> flag to build a linkable object file. This is already supplied by the <code>go</code> command and by Bazel. Any other build systems that invoke the Go compiler directly will need to make sure they pass this flag as well.</p><p>The Go compiler no longer accepts the <code>-importmap</code> flag. Build systems that invoke the Go compiler directly must use the <code>-importcfg</code> flag instead.</p><p>通过调整GC(垃圾回收)策略可以降低垃圾回收占用的CPU用量。</p><p>由于golang对gc的调优能力比较有限，在1.19之前仅有GOGC参数来控制(GOGC是上次垃圾回收后heap size增长率)，memory ballast方法通过在堆上分配一个巨大的对象来欺骗GOGC，让go可以尽量充分利用堆空间减少GC触发频率，uber后来分享的auto gc tuner可以设置内存占用阈值，动态的调整GOGC参数，来使的系统使用内存与目标趋近，go 1.19提供了新参数debug.SetMemoryLimit，可以直接设置触发GC时的内存阈值，因此上面两种间接的方案就可以废弃了。</p><p>方法:</p><ol><li>debug.SetMemoryLimit 设置触发GC的内存阈值</li><li>GOGC=off关闭GC</li></ol><p>即可实现只有在达到Limit时才触发GC，在GC触发频率高的场景可以大大优化GC的CPU消耗，同时也因为降低了GC频率，<strong>接口999延迟也会有提升</strong>，也相应提升了用户体验。</p><h2 id="线上升级案例" tabindex="-1"><a class="header-anchor" href="#线上升级案例" aria-hidden="true">#</a> 线上升级案例</h2><h3 id="_1-17升级" tabindex="-1"><a class="header-anchor" href="#_1-17升级" aria-hidden="true">#</a> 1.17升级</h3><p>cpu：从6.098%降低到5.956%，约有**3%-4%**的CPU性能提升</p><p>内存：从2.73GB降低到2.36GB 提升<strong>13%</strong></p><h3 id="_1-19升级" tabindex="-1"><a class="header-anchor" href="#_1-19升级" aria-hidden="true">#</a> 1.19升级</h3><p>设置GOMEMLIMIT=1,073,741,824 GOGC=off 为2倍内存用量，限制触发GC阈值为1GB</p><p>cpu：从23.104%降低到21.317%，约有**7%-8%**的CPU性能提升</p><p>内存：从500MB占用增加到1GB</p><p>gc触发频率：从271ms到1.9秒</p><p>profile中gc情况（runtime.gcBgMarkWorker）：从8.78%降低到 1.88%</p><p>GC耗时：50%分位数从170us升高到231us，100%分位数从4.16ms升高到5.37ms</p><p>接口平均耗时：从13.7ms降低到13.1ms 降低0.6ms共<strong>4%</strong></p><p>接口999分位耗时：<strong>非常稳定</strong> ，从322ms降低到249ms降低了73ms占比<strong>23%</strong></p><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference" aria-hidden="true">#</a> reference</h2><p><a href="https://go.dev/doc/go1.16" target="_blank" rel="noopener noreferrer">https://go.dev/doc/go1.16<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://go.dev/doc/go1.17" target="_blank" rel="noopener noreferrer">https://go.dev/doc/go1.17<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://go.dev/doc/go1.18" target="_blank" rel="noopener noreferrer">https://go.dev/doc/go1.18<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://go.dev/doc/go1.19" target="_blank" rel="noopener noreferrer">https://go.dev/doc/go1.19<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://go.dev/doc/go1.20" target="_blank" rel="noopener noreferrer">https://go.dev/doc/go1.20<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://colobu.com/2022/07/16/A-Guide-to-the-Go-Garbage-Collector/" target="_blank" rel="noopener noreferrer">https://colobu.com/2022/07/16/A-Guide-to-the-Go-Garbage-Collector/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/xyz3282836/monodoc/edit/master/packages/note/src/raw/Go/版本升级.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: liuruizhou@bilibili.com">liuruizhou</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><!----><a href="/raw/Go/%E6%A6%82%E5%BF%B5.html" class="nav-link next" aria-label="基础概念"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">基础概念<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2023 rz</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-cd392658.js" defer></script>
  </body>
</html>
