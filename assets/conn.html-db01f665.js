import{_ as n,W as s,X as a,Y as t}from"./framework-c08a2544.js";const p={},o=t(`<h1 id="conn" tabindex="-1"><a class="header-anchor" href="#conn" aria-hidden="true">#</a> conn</h1><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> conn <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// low level connection.</span>
	pconn protocolConn <span class="token comment">// 需要</span>
	ed    <span class="token operator">*</span>encodeDecode
<span class="token punctuation">}</span>
<span class="token comment">// Dial connects to the Memcache server at the given network and</span>
<span class="token comment">// address using the specified options.</span>
<span class="token keyword">func</span> <span class="token function">Dial</span><span class="token punctuation">(</span>network<span class="token punctuation">,</span> address <span class="token builtin">string</span><span class="token punctuation">,</span> options <span class="token operator">...</span>DialOption<span class="token punctuation">)</span> <span class="token punctuation">(</span>Conn<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	do <span class="token operator">:=</span> dialOptions<span class="token punctuation">{</span>
		dial<span class="token punctuation">:</span> net<span class="token punctuation">.</span>Dial<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> option <span class="token operator">:=</span> <span class="token keyword">range</span> options <span class="token punctuation">{</span>
		option<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>do<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	netConn<span class="token punctuation">,</span> err <span class="token operator">:=</span> do<span class="token punctuation">.</span><span class="token function">dial</span><span class="token punctuation">(</span>network<span class="token punctuation">,</span> address<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> pkgerr<span class="token punctuation">.</span><span class="token function">WithStack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
  <span class="token comment">// 调用ascii_conn.go 中的newASCIIConn返回protocolConn 接口的实现</span>
	pconn<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">newASCIIConn</span><span class="token punctuation">(</span>netConn<span class="token punctuation">,</span> do<span class="token punctuation">.</span>readTimeout<span class="token punctuation">,</span> do<span class="token punctuation">.</span>writeTimeout<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>conn<span class="token punctuation">{</span>pconn<span class="token punctuation">:</span> pconn<span class="token punctuation">,</span> ed<span class="token punctuation">:</span> <span class="token function">newEncodeDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// low level connection that implement memcache protocol provide basic operation.</span>
<span class="token keyword">type</span> protocolConn <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Populate</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> cmd <span class="token builtin">string</span><span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">,</span> flags <span class="token builtin">uint32</span><span class="token punctuation">,</span> expiration <span class="token builtin">int32</span><span class="token punctuation">,</span> cas <span class="token builtin">uint64</span><span class="token punctuation">,</span> data <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Item<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">GetMulti</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> keys <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>Item<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Touch</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">,</span> expire <span class="token builtin">int32</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">IncrDecr</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> cmd<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">,</span> delta <span class="token builtin">uint64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">uint64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),e=[o];function c(i,l){return s(),a("div",null,e)}const k=n(p,[["render",c],["__file","conn.html.vue"]]);export{k as default};
